{% extends "layout.njk" %}

{% macro typeIcon(type) -%}
  <img class="type" src="/icons/types/{{ type }}.png" alt="{{ type | capitalize }}-type">
{%- endmacro %}

{% block content %}
  <h1>
    Pokémoves
    <img src="/icons/gbl.png" alt="">
  </h1>
  <p>
    Move counts for Pokémon GO battles.
  </p>
  <p>
    <small><em>Last updated: {{ lastUpdated }}</em></small>
  </p>
  <h2>
    Settings
  </h2>
  <input type="checkbox" id="show-deltas" name="show-deltas" class="setting">
  <label for="show-deltas">
    Show advanced energy deltas
  </label>
  <script src="{{ resources['/js/deltas.js'] }}"></script>
  <button id="use-dark-theme" class="theme-button setting">
    <img src="/icons/themes/dark.png" alt="">
    Switch to Dark theme
  </button>
  <button id="use-light-theme" class="theme-button setting">
    <img src="/icons/themes/light.png" alt="">
    Switch to Light theme
  </button>
  <script src="{{ resources['/js/theme.js'] }}"></script>
  <input id="search" type="text" placeholder="Search"  style="visibility: hidden;" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  {% for pokemon in list %}
    {% set isMew = pokemon.name === "Mew" %}
    <h2 data-name="{{ pokemon.name | lower }}">
      {{ pokemon.name }}{{ "*" if isMew }}
    </h2>
    {% if isMew %}
      <p>* Only some of Mew’s fast moves are shown.</p>
    {% endif %}
    <table>
      <tr>
        <th class="{{ pokemon.types | first }}">
          {% for type in pokemon.types %}
            {{ typeIcon(type) }} {{ "/" if not loop.last }}
          {% endfor %}
        </th>
        {% for fastMove in pokemon.counts[0].fastMoves %}
          {% set type = "hidden" if fastMove.name === "Hidden Power" else fastMove.type %}
          <th class="{{ type }}">
            <div>
              {{ typeIcon(type) }}
              {{ fastMove.name }}
            </div>
            <div>
              <small>
                +{{ fastMove.energy }} energy
                / {{ fastMove.turns }} turn{{ "s" if fastMove.turns > 1 }}
              </small>
            </div>
          </th>
        {% endfor %}
      </tr>
      {% for row in pokemon.counts %}
        {% set chargedMove = row.chargedMove %}
        {% set type = chargedMove.type %}
        <tr class="{{ type }}">
          <th>
            <div>
              {{ typeIcon(type) }}
              {{ chargedMove.name }}
            </div>
            <div>
              <small>
                {{ chargedMove.energy }} energy
              </small>
            </div>
          </th>
          {% for fastMove in row.fastMoves %}
            <td>
              <div>
                {% set firstCount = (fastMove.counts | first) %}
                {% for count in fastMove.counts %}
                  {% if count === firstCount %}
                    {{ count }}
                  {%- else %}
                    <em>
                      {{ count -}}
                    </em>
                  {%- endif %}
                  {{- "," if not loop.last }}
                {% endfor %}
              </div>
              <div>
                {% set remainder = -chargedMove.energy % fastMove.energy %}
                <small class="delta">
                  Δ +{{ 0 if remainder === 0 else fastMove.energy - remainder }} / -{{ remainder }}
                </small>
              </div>
            </td>
          {% endfor %}
        </tr>
      {% endfor %}
    </table>
  {% endfor %}
  <script src="{{ resources['/js/search.js'] }}"></script>
  <script src="{{ resources['/js/scroll.js'] }}"></script>
{% endblock %}
